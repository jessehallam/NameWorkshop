(function(){var e,r,o,t,s,h,u,f,c,l,a,v,y,i,p,w={}.hasOwnProperty,n=function(n,t){function r(){this.constructor=n}for(var i in t)w.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n};i=function(n,t){return Math.floor(Math.random()*(t-n))+n};p={start:[{m:/\(/,t:"("},{m:/\)/,t:")"},{m:/\|/,t:"|"},{m:/\^/,t:"^"},{m:/</,t:"<",next:"named"},{m:/\[/,t:"[",next:"range"},{m:/\{/,t:"{",next:"rep"},{m:/./,t:"CHAR"}],named:[{m:/[a-zA-Z0-9]/,t:"CHAR"},{m:/-|_/,t:"ALTCHAR"},{m:/>/,t:">",next:"start"}],range:[{m:/[a-zA-Z0-9]/,t:"CHAR"},{m:/-/,t:"-"},{m:/]/,t:"]",next:"start"}],rep:[{m:/\d+/,t:"INT"},{m:/-/,t:"-"},{m:/\}/,t:"}",next:"start"}]};c=function(){function n(n){this.input=n;this.i=0;this.state="start";this.line=0;this.col=0}return n.prototype.readTokens=function(){for(var t,n=[];t=this.$readNext();)n.push(t);return n},n.prototype.$advancePos=function(n){var i,r,u,f,t;for(t=[],r=u=0,f=n.length;u<f;r=++u)i=n[r],i==="\r"?i==="\n"?(this.line++,t.push(this.col=0)):t.push(void 0):i==="\n"?(this.line++,t.push(this.col=0)):t.push(this.col++);return t},n.prototype.$readNext=function(){var t,n,u,i,f,r;for(r=p[this.state],i=0,f=r.length;i<f;i++)if(n=r[i],this.input.search(n.m)===0)return t=n.m.exec(this.input),u={tok:n.t,val:t[0],match:t,pos:[this.line,this.col]},this.input=this.input.substr(t[0].length),n.next&&(this.state=n.next),u},n}();t=function(){function n(){}return n.prototype.eval=function(){return""},n.prototype.toString=function(){return"Expression()"},n}();r=function(t){function i(n){var t;this.val=n?function(){var i,u,r;for(r=[],i=0,u=n.length;i<u;i++)t=n[i],r.push(t.val);return r}().join(""):""}return n(i,t),i.prototype.eval=function(){return this.val},i.prototype.toString=function(){return"'"+this.val+"'"},i}(t);u=function(t){function i(){this.item=null}return n(i,t),i.prototype.toString=function(){return"ItemExpresion("+this.item+")"},i}(t);e=function(t){function i(n){this.item=n}return n(i,t),i.prototype.eval=function(n){var t;return t=this.item.eval(n),t&&(t=t[0].toUpperCase()+t.substr(1)),t},i.prototype.toString=function(){return"Capital("+this.item.toString()+")"},i}(u);f=function(t){function i(){this.items=[]}return n(i,t),i.prototype.toString=function(){return"ItemsExpression("+this.items.join(", ")+")"},i}(t);h=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.eval=function(n){var t;return function(){var i,f,r,u;for(r=this.items,u=[],i=0,f=r.length;i<f;i++)t=r[i],u.push(t.eval(n));return u}.call(this).join("")},i.prototype.toString=function(){return"ExpressionList("+this.items.join(", ")+")"},i}(f);s=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.eval=function(n){return this.items.length?this.items[i(0,this.items.length)].eval(n):""},r.prototype.toString=function(){return this.items.join(" | ")},r}(f);l=function(t){function i(n){this.name=n}return n(i,t),i.prototype.eval=function(n){return n[this.name]?n[this.name].eval(n):""},i.prototype.toString=function(){return"<"+this.name+">"},i}(t);v=function(t){function r(n,t){this.min=n.charCodeAt(0);this.max=t.charCodeAt(0)+1}return n(r,t),r.prototype.eval=function(){return String.fromCharCode(i(this.min,this.max))},r.prototype.toString=function(){return"Range["+String.fromCharCode(this.min)+" - "+String.fromCharCode(this.max-1)+"]"},r}(t);y=function(t){function r(n,t){this.expression=n;this.repetition=t}return n(r,t),r.prototype.eval=function(n){var u,e,f,t,r;if(u=i(this.repetition.min,this.repetition.max+1),!(u<=0)){for(f=[],e=t=0,r=u-1;0<=r?t<=r:t>=r;e=0<=r?++t:--t)f.push(this.expression.eval(n));return f.join("")}},r.prototype.toString=function(){return this.expression.toString()+"{"+this.repetition.min+" - "+this.repetition.max+"}"},r}(t);o=function(t){function i(n){this.item=n}return n(i,t),i.prototype.eval=function(n){return n=n||{expressions:{}},this.item.eval(n)},i.prototype.toString=function(){return this.item.toString()},i}(u);a=function(){function n(n){this.input=n;this.i=0}return n.prototype.program=function(){var n;if(n=this.$readExpressionBranch(),this.$la())throw new Error("Parse error");return new o(n)},n.prototype.$expect=function(n){if(this.$la(0)===n)return this.input[this.i++]},n.prototype.$invalidToken=function(n){return n=n||this.input[this.i],new Error("Got `"+(n?n.tok:"")+"` at "+(n?n.pos:"EOF"))},n.prototype.$la=function(n){return n==null&&(n=0),this.input[this.i+n]?this.input[this.i+n].tok:void 0},n.prototype.$readExpression=function(){var i,n,t;if(i=this.$expect("^"),n=this.$readRangeExpression()||this.$readNamedExpression()||this.$readGroupExpression()||this.$readConstantExpression(),n)return t=this.$readRepeatExpression(),t&&(n=new y(n,t)),i&&(n=new e(n)),n},n.prototype.$readConstantExpression=function(){var n,t;if(t=[],n=this.$expect("CHAR")){for(t.push(n);n=this.$expect("CHAR");)t.push(n);return new r(t)}},n.prototype.$readExpressionBranch=function(){var t,n,i;if(t=this.$readExpressionList()){for(n=new s,n.items.push(t);i=this.$expect("|");)(t=this.$readExpressionList())?n.items.push(t):n.items.push(new r);return n}},n.prototype.$readExpressionList=function(){var n,t;if(n=this.$readExpression()){for(t=new h,t.items.push(n);n=this.$readExpression();)t.items.push(n);return t}},n.prototype.$readGroupExpression=function(){var n;if(this.$expect("(")){if(!(n=this.$readExpressionBranch()))throw this.$invalidToken();if(!this.$expect(")"))throw this.$invalidToken();return n}},n.prototype.$readNamedExpression=function(){var n,t;if(this.$expect("<")){if(!(n=this.$expect("CHAR")))throw this.$invalidToken();for(t=new l,t.name=n.val;n=this.$expect("CHAR")||this.$expect("ALTCHAR");)t.name+=n.val;if(!this.$expect(">"))throw this.$invalidToken();return t}},n.prototype.$readRangeExpression=function(){var n,t;if(this.$expect("[")){if(!(t=this.$expect("CHAR")))throw this.$invalidToken();if(!this.$expect("-"))throw this.$invalidToken();if(!(n=this.$expect("CHAR")))throw this.$invalidToken();if(!this.$expect("]"))throw this.$invalidToken();return new v(t.val[0],n.val[0])}},n.prototype.$readRepeatExpression=function(){var n,t;if(this.$expect("{")){if(!(t=this.$expect("INT")))throw this.$invalidToken();if(n=t,this.$expect("-")&&!(n=this.$expect("INT")))throw this.$invalidToken();if(!this.$expect("}"))throw this.$invalidToken();return{min:parseInt(t.val),max:parseInt(n.val)}}},n}();this.Parser_v3={Lexer:c,Parser:a}}).call(this);